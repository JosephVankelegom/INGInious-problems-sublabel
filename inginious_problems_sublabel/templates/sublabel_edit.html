{# This file is part of INGInious. See the LICENSE and the COPYRIGHTS files for #}
{# more information about the licensing of this file. #}

<style>
    .hwt-content{
        padding-left: 35px;
    }
    .hwt-content mark.yellow{
        background-color: yellow;
    }
    .hwt-content mark.red{
        background-color: red;
    }
    .hwt-content mark.blue{
        background-color: blue;
    }
    .hwt-content mark.green{
        background-color: yellowgreen;
    }
    .hwt-content mark.random{
        background: linear-gradient(to top, pink 0%, pink 50%, paleturquoise 50%, paleturquoise 100%) ;
    }
</style>

<div class="form-group row">
    <label for="header-PID" class="col-sm-2 control-label">Context</label>
    <div class="col-sm-10">
        <textarea id="header-PID" class="form-control" name="problem[PID][header]"></textarea>
    </div>
</div>

<div class="form-group row">
    <label for="code-PID" class="col-sm-2 ">Code</label>
    <div class="col-sm-10"><textarea id="code-PID" class="form-control" name="problem[PID][code]"
                                     oninput='this.style.height= ""; this.style.height = this.scrollHeight + "px"' on
                                     style="width: 1044px; min-height: 150px; border-color: darkgray; padding-left: 35px;"  ></textarea>
    </div>
</div>
<div class="form-row" >
    <button id="eraseButton" type="button">Click me to erase answer</button>
    <button id="addLabel" type="button">Click me to add label</button>
    <button id="TestButton" type="button"></button>
</div>
<div class="form-row" id="labelDiv">
</div>
<div class="form-group row">
    <label for="answer-PID" class="col-sm-2 control-label">Answer</label>
    <div class="col-sm-10">
        <input type="text" class="form-control" id="answer-PID" name="problem[PID][answer]" placeholder="Leave empty for Docker assessment"/>
    </div>
</div>


<div id="context-menu" class="context-menu">
    <ul id="list_context-menu"></ul>
</div>

<div id="context-menu" class="context-menu">
    <ul id="list_context-menu"></ul>
</div>


<textarea id="label_id"  name="problem[PID][label_id]" readonly></textarea>
<textarea hidden id="label_color" name="problem[PID][label_color]" readonly></textarea>
<textarea hidden id="label_value" name="problem[PID][label_value]" readonly></textarea>

<script>
    {#
    $(document).ready(function() {

        let numberOfLabels = 3;

        let highlightValueArray =[[[]],[[]],[[]]]; // indexes of highlighted text is situated.
        let textarea = $('#code-PID')
        createHighlightTextarea()

        function createHighlightTextarea(){
            if(numberOfLabels === 1){textarea.highlightWithinTextarea({ highlight: highlightValueArray[0], className:'yellow'});}
            if(numberOfLabels === 2){textarea.highlightWithinTextarea({ highlight:[
                {highlight: highlightValueArray[0], className: 'yellow'},
                {highlight: highlightValueArray[1], className: 'blue'}]}
            );}
            if(numberOfLabels === 3){textarea.highlightWithinTextarea({ highlight:[
                {highlight: highlightValueArray[0], className: 'yellow'},
                {highlight: highlightValueArray[1], className: 'blue'},
                {highlight: highlightValueArray[2], className: 'red'}]}
            );}
        }

        function updateValues() {
            textarea.highlightWithinTextarea('destroy');
            createHighlightTextarea()
            document.getElementById("answer-PID").value= "label 1: " + highlightValueArray[0].toString()+"   label 2: " + highlightValueArray[1].toString()+"   label 3: " + highlightValueArray[2].toString();
        }

        document.getElementById('highlight_button').addEventListener('mousedown', function() {
            const codeAreaval = document.getElementById('code-PID');
            let selS = codeAreaval.selectionStart;
            let selE = codeAreaval.selectionEnd;
            highlightValueArray[0] = updateArray(selS,selE, highlightValueArray[0]);
            updateValues();

        })

        document.getElementById('highlight_button2').addEventListener('mousedown', function() {
            const codeAreaval = document.getElementById('code-PID');
            let selS = codeAreaval.selectionStart;
            let selE = codeAreaval.selectionEnd;
            highlightValueArray[1] = updateArray(selS,selE, highlightValueArray[1]);
            updateValues();

        })

        document.getElementById('highlight_button3').addEventListener('mousedown', function() {
            const codeAreaval = document.getElementById('code-PID');
            let selS = codeAreaval.selectionStart;
            let selE = codeAreaval.selectionEnd;
            highlightValueArray[2] = updateArray(selS,selE, highlightValueArray[2]);
            updateValues();
        })

        document.getElementById('eraseButton').addEventListener('click', function () {
            highlightValueArray=[[[]],[[]],[[]]]
            updateValues()
        })

        function updateArray(start, end, array){
            let result = array.flat();

            let indexStart  = result.findIndex(function(value){return value>=start}) // rajouter si plus grand que tout etc
            let indexEnd    = result.findIndex(function(value){return value>=end})
            if(indexStart   === -1){indexStart = result.length}
            if(indexEnd     === -1){indexEnd = result.length}
            let usefulStart = (indexStart%2) === 0
            let usefulEnd   = (indexEnd%2) === 0


            if(indexStart === result.length){
                console.log(start, indexStart, "enter indexStart max")
                result = result.concat([start, end])}
            else if(indexEnd === 0){
                console.log("enter indexEnd min")
                result = [start, end].concat(result)}

            else if(usefulStart && usefulEnd){
                result.splice(indexStart,indexEnd-indexStart,start,end)
            }
            else if(usefulStart && !usefulEnd){
                result.splice(indexStart,indexEnd-indexStart,start)
            }
            else if(!usefulStart && usefulEnd){
                result.splice(indexStart,indexEnd-indexStart,end)
            }
            else{
                result.splice(indexStart,indexEnd-indexStart)
            }

            let resultFormat = []
            while (result.length) resultFormat.push(result.splice(0,2));
            return resultFormat;

        }



    });
     #}
</script>


{#
<div class="form-group row">
    <label for="codeInput-sublabel" class="col-sm-2 control-label">CodeInput</label>
    <div class="col-sm-10">
        <textarea id="codeInput-sublabel" class="form-control" oninput="updateText()" name="problem[sublabel][codeInput]" oncontextmenu="highlightFromIndexes(this)"></textarea>
    </div>
    <label for="codeHighlight" class="col-sm-2 control-label">Code Highlighted</label>
    <div class="col-sm-10">
        <div id="codeHighlight" class="codeHighlight" oncontextmenu="showSelection(this)"></div>
    </div>
</div>
#}













